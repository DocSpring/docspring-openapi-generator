#!/bin/sh
set -e
cd "$(dirname "$0")/.."

LANGUAGE="$1"
CONFIG_FILE="swagger-config.$LANGUAGE.json"

if [ -z "$LANGUAGE" ]; then
  for LANG in ruby python java php javascript; do # go rust elixir swift4 objc
    echo "Generating $LANG client library..."
    ./scripts/generate "$LANG"
  done
  exit
fi

mkdir -p "examples/$LANGUAGE"
mkdir -p "scripts/$LANGUAGE"

if [ ! -f "$CONFIG_FILE" ]; then
  echo "Could not find $CONFIG_FILE"
  ./swagger config-help -l "$LANGUAGE"
  exit 1
fi

./scripts/swagger generate \
  -i ../form_api/swagger/v1/swagger.json \
  -l "$LANGUAGE" \
  -c "$CONFIG_FILE" \
  -o "clients/$LANGUAGE"

if [ -f "./scripts/$LANGUAGE/post_generate" ]; then
  ./scripts/$LANGUAGE/post_generate
fi
