From 548321bdd517ae2ec99a13992691d9fa0dfba09e Mon Sep 17 00:00:00 2001
From: Nathan Broadbent <git@ndbroadbent.com>
Date: Sun, 2 Sep 2018 00:01:50 0700
Subject: [PATCH] Applied patch

---
 form_api/__init__.py    |  1
 form_api/api_client.py  |  8 --
 form_api/apis/client.py | 88
 setup.py                |  8 ---
 4 files changed, 99 insertions(), 6 deletions(-)
 create mode 100644 form_api/apis/client.py

diff --git a/form_api/__init__.py b/form_api/__init__.py
index 901b42a..a2e64f5 100644
--- a/form_api/__init__.py
 b/form_api/__init__.py
@@ -29,6 29,7 @@ from .models.templatestemplate_idsubmissionsbatch_submission import Templatestem

 # import apis into sdk package
 from .apis.pdf_api import PDFApi
from .apis.client import Client

 # import ApiClient
 from .api_client import ApiClient
diff --git a/form_api/api_client.py b/form_api/api_client.py
index 45fc700..5b8275c 100644
--- a/form_api/api_client.py
 b/form_api/api_client.py
@@ -74,8 74,12 @@ class ApiClient(object):
         self.user_agent = 'Swagger-Codegen/0.2.1/python'

     def __del__(self):
-        self.pool.close()
-        self.pool.join()
        # Ignore RuntimeError("cannot join current thread") from threading.py
        try:
            self.pool.close()
            self.pool.join()
        except RuntimeError:
            pass

     @property
     def user_agent(self):
diff --git a/form_api/apis/client.py b/form_api/apis/client.py
new file mode 100644
index 0000000..b6d62f3
--- /dev/null
 b/form_api/apis/client.py
@@ -0,0 1,88 @@
# coding: utf-8

"""
    API V1

    No description provided (generated by Swagger Codegen https://github.com/swagger-api/swagger-codegen)

    OpenAPI spec version: v1

    Generated by: https://github.com/swagger-api/swagger-codegen.git
"""

from __future__ import absolute_import

import sys
import os
import re
import time

from .pdf_api import PDFApi

class PollTimeoutError(Exception):
    pass

class Client(PDFApi):
    """
      FormAPI API Client
    """

    def generate_pdf(self, data, **kwargs):
        """
        Generates a new PDF and waits for PDF to be ready.
        :param Data data:
        :return: InlineResponse2011
        """
        template_id = data.get('template_id')
        del data['template_id']

        kwargs['create_submission_body'] = data
        kwargs['_return_http_data_only'] = True

        (data) = self.generate_pdf_with_http_info(template_id, **kwargs)

        submission = data.submission

        start_time = time.time()
        timeout = 60
        if 'timeout' in kwargs and kwargs['timeout'] is not None:
            timeout = kwargs['timeout']

        # Wait for submission to be ready
        while (submission.state == 'pending'):
            time.sleep(1)
            submission = self.get_submission(submission.id)

            if time.time() - start_time > timeout:
                raise PollTimeoutError("PDF was not ready after %d seconds!" % timeout)

        return submission


    def combine_submissions(self, data, **kwargs):
        """
        Combines multiple submissions into a single PDF, and waits for merged PDF to be ready.
        :param Data data
        :return: InlineResponse201
        """
        kwargs['create_combined_submission_body'] = data
        kwargs['_return_http_data_only'] = True

        (data) = self.combine_submissions_with_http_info(**kwargs)

        combined_submission = data.combined_submission

        start_time = time.time()
        timeout = 60
        if 'timeout' in kwargs and kwargs['timeout'] is not None:
            timeout = kwargs['timeout']

        # Wait for submission to be ready
        while (combined_submission.state == 'pending'):
            time.sleep(1)
            combined_submission = self.get_combined_submission(combined_submission.id)

            if time.time() - start_time > timeout:
                raise PollTimeoutError("Merged PDF was not ready after %d seconds!" % timeout)

        return combined_submission
diff --git a/setup.py b/setup.py
index 32ed6f5..9e301b0 100644
--- a/setup.py
 b/setup.py
@@ -28,10 28,10 @@ REQUIRES = ["urllib3 >= 1.15", "six >= 1.10", "certifi", "python-dateutil"]
 setup(
     name=NAME,
     version=VERSION,
-    description="API V1",
-    author_email="",
-    url="",
-    keywords=["Swagger", "API V1"],
    description="FormAPI Client",
    author_email="support@formapi.io",
    url="https://formapi.io",
    keywords=["FormAPI", "PDF", "forms"],
     install_requires=REQUIRES,
     packages=find_packages(),
     include_package_data=True,
--
2.12.2

